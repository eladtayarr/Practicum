<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Trisi Sinai || Practicum</title>
<link rel="shortcut icon" href="images/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    
    <link rel="shortcut icon" href="images/favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/src/css/animate.css">
    <link rel="stylesheet" href="/src/css/icomoon.css">
    <link rel="stylesheet" href="/src/css/bootstrap.css">
    <link rel="stylesheet" href="/src/css/superfish.css">
    <link rel="stylesheet" href="/src/css/flexslider.css">
    <link rel="stylesheet" href="/src/css/magnific-popup.css">
    <link rel="stylesheet" href="/src/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/src/css/cs-select.css">
    <link rel="stylesheet" href="/src/css/cs-skin-border.css">
    <link rel="stylesheet" href="/src/css/style.css">
    
    <style>
        .user-row {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            padding: 15px;
        }
        .users-header {
            text-align: center;
            margin-bottom: 30px;
            font-size: 40px;
            font-weight: 400;
            position: relative;
            color: #de6277;
        }
        .users-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
            padding: 15px;
        }
        .user-card {
             width: 300px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
            text-align: center; /* Center align content */
            padding: 15px;
        }

        .user-card:hover {
            transform: translateY(-5px);
        }

        .user-card p {
            margin: 5px 0;
            font-size: 16px;
            color: #333333;
        }

        .user-card .user-info {
            font-weight: bold;
        }

        .user-card .user-icon {
            margin-right: 10px;
        }

        .user-card img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 10px;
            object-fit: cover;
        }

        .delete-btn {
            background-color:  #de6277;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
            align-items: center;
        }

        .delete-btn:hover {
            background-color: #000000;
        }
        .filter-bar {
    background-color: #fff;
    border: 0px solid #fff;
    border-radius: 5px;
    padding: 5px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px #f2f2f2(0, 0, 0, 0.1);
}

.filter-bar label {
    font-weight: bold;
    margin-right: 400px;
}

.filter-bar select {
    padding: 8px;
    border: 1px solid #fff;
    border-radius: 3px;
    background-color: #fff;
    font-size: 14px;
    color: #333;
}

.filter-bar select:hover {
    border-color: #999;
}

.filter-bar select:focus {
    outline: none;
    border-color: #ffffff;
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
}
.fh5co-section-gray {
		background: rgba(0, 0, 0, 0);
	}
       
    #footer #fh5co-header-subscribe button {
    position: absolute;
    top: 20px;
    right: -20px;
    border-top-left-radius: 0px !important;
    border-bottom-left-radius: 0px !important;
    background: #de6277;
    border: none;
}

.message-container {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    display: inline-block;
}
 
    </style>

<header id="fh5co-header-section" class="sticky-banner">
    <div class="container">
        <div class="nav-header">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle dark"><i></i></a>
            <h1 id="fh5co-logo"><a href="HomeManager.html"><i class="icon-home"></i> Trisi Sinai <span> Ltd.</span></a></h1>
            <nav id="fh5co-menu-wrap" role="navigation">
                <ul class="sf-menu" id="fh5co-primary-menu">
                    <li class="active"><a href="../../templates/Manager/HomeManager.html">Home</a></li>
                    <li>
                        <a>Products</a>
                        <ul class="fh5co-sub-menu">
                            <li><a href="../../templates/Products/allProducts-Manager.html">View All Products</a></li>
                            <li><a href="../../templates/Products/addNewProduct-Manager.html">Add New Product</a></li>
                            <li><a href="../../templates/Products/updateProducts-Manager.html">Update Product</a></li>
                        </ul>
                    </li>
                    <!-- New "Deals" tab containing "Deal" and "Deals View" links -->
                    <li>
                        <a>Deals</a>
                        <ul class="fh5co-sub-menu">
                            <li><a href="/../../templates/Manager/DealsV-Manager.html">View All Deals</a></li>
                            <li><a href="../../templates/Manager/addD-Manager.html">Add New Deal</a></li>
                        </ul>
                    </li>

                    <li>
                        <a>Manage</a>
                        <ul class="fh5co-sub-menu">
                            <li><a href="../../templates/Manager/addNewCustomer-Manager.html">Add New Customer</a></li>
                            <li><a href="../../templates/Manager/Add_ViewUsers-Manager.html">Add New Users</a></li>
                            <li><a href="../../templates/Installer/Add-Installations.html">Add New Installer</a></li>
                        </ul>
                    </li>
                    <li>
                        <a>Installations</a>
                        <ul class="fh5co-sub-menu">
                            <li><a href="../../templates/Installer/View-Installations.html">View All Installations</a></li>
                            <li><a href="../../templates/Installer/add-Installer.html">Add New Installation</a></li>
                        </ul>
                    </li>
                    <li>
                        <a>Reports</a>
                        <ul class="fh5co-sub-menu">
                            <li><a href="../../templates/Reports/Reports-Customer.html">Customers Reports</a></li>
                            <li><a href="../../templates/Reports/Reports-Deal.html">Deals Reports</a></li>
                            <li><a href="../../templates/Reports/Reports-Products.html">Products Reports</a></li>
                        </ul>
                    </li>
                    <li><a href="../../templates/Dashbord/Dashbord-Manager.html">Manager Dashbord</a></li>
                </ul>
            </nav>
        </div>
    </div>
</header>

        <aside id="fh5co-hero" class="js-fullheight">
            <div class="flexslider js-fullheight">
                <ul class="slides">
                    <li style="background-image: url(images/cov.png);">
                        <div class="overlay"></div>
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-8 col-md-offset-2 text-center js-fullheight slider-text">
                                    <div class="slider-text-inner">
                                        <h2 class="heading-title">Manager</h2>
                                        <p class="fh5co-lead"><i class="icon-heart3"></i> </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </aside>

	    <div id="fh5co-blog-section" class="fh5co-section-gray">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 col-md-offset-2 text-center heading-section animate-box">
                        <h3>Users</h3>
                    </div>
                </div>
            
                <div id="users-container" class="users-container"></div><br><br><br>
                 
                <div class="filter-bar">
                    <label for="filter">Filter by Role:</label>
                    <select id="filter">
                        <option value="all">All</option>
                        <option value="admin">Admin</option>
                        <option value="customer">Customer</option>
                        <option value="user">User</option>
                    </select>
                </div>
                
                <br><br><br><br><br><br>
                <div style="border-bottom: 5px solid rgb(255, 255, 255);"></div>
                <br><br><br>
                
                <form id="add-user-form" >
                    <div id="fh5co-blog-section" class="fh5co-section-gray">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-8 col-md-offset-2 text-center heading-section animate-box">
                                    <h3>Add New User</h3>
                                </div>
                            </div></div>
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="UserName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="Password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="Email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone:</label>
                        <input type="tel" id="phone" name="Phone" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="RoleType">User Type:</label>
                        <select class="form-control" id="RoleType" name="RoleType">
                            <option value="">Select Role Type of the </option>
                            <option value="Customer">Customer</option>
                            <option value="Installer">Installer</option>
                            <option value="Admin">Administrator</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="sub">Add User</button><br>
                    <div id="successMessage" style="display: none;" class="alert alert-success" role="alert">
                        User and partner added successfully!
                    </div>
                    <div id="errorMessage" style="display: none;" class="alert alert-danger" role="alert">
                        Failed to add user and partner.
                    </div>
                </form>

			</div>
        </div>
    </div>
        <footer>
            <div id="footer">
                <div class="container">
                    <div class="row row-bottom-padded-md">
                        <div class="col-md-3">
                            <h3 class="section-title">About Us</h3>
                            <p>
                                We, Bar Michal and Nofar, information systems management students at the College of Management, own all the exclusive rights to this website 
                            </p>
                        </div>

                        <div class="col-md-3 col-md-push-1">
                            <h3 class="section-title">Links</h3>
                            <ul>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">Assets</a></li>
                                <li><a href="#">Agent</a></li>
                                <li><a href="#">Blog</a></li>
                                <li><a href="#">Contact</a></li>
                            </ul>
                        </div>

                        <div class="col-md-3">
                            <h3 class="section-title">Information</h3>
                            <ul>
                                <li><a href="#">Terms &amp; Condition</a></li>
                                <li><a href="#">License</a></li>
                                <li><a href="#">Privacy &amp; Policy</a></li>
                                <li><a href="#">Contact Us</a></li>
                            </ul>
                        </div>                        
                    </div>
                </div>
            </div>
       

        </footer>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/sticky.js"></script>
<script src="js/hoverIntent.js"></script>
<script src="js/superfish.js"></script>
<script src="js/jquery.flexslider-min.js"></script>
<script src="js/bootstrap-datepicker.min.js"></script>
<script src="js/classie.js"></script>
<script src="js/selectFx.js"></script>
<script src="js/main.js"></script>


<script>
    window.onload = async () => {
        try {
            const response = await fetch('/Users');
            const users = await response.json();
            const usersContainer = document.getElementById('users-container');
            const filterSelect = document.getElementById('filter');
            const filterUsers = () => {
                const selectedRole = filterSelect.value;
                const filteredUsers = users.filter(user => {
                    if (selectedRole === 'all') {
                        return true; // Show all users
                    } else {
                        return user.Role.toLowerCase() === selectedRole; // Filter by role
                    }
                });

            usersContainer.innerHTML = '';
            filteredUsers.forEach(user => {
                    addUserToUI(user);
                });
            };

            // Initial load - show all users
            filterUsers();

            // Event listener for filter change
            filterSelect.addEventListener('change', filterUsers);
        } catch (error) {
            console.error('Error fetching users:', error);
        }
    };


    function addUserToUI(user) {
        const usersContainer = document.getElementById('users-container');
        const userElement = document.createElement('div');
        userElement.classList.add('user-row');
        userElement.innerHTML = `
        <div class="user-card">
            <img src="https://as1.ftcdn.net/jpg/05/53/79/60/220_F_553796090_XHrE6R9jwmBJUMo9HKl41hyHJ5gqt9oz.jpg" alt="User Avatar">
            <p class="user-info">UserName: ${user.UserName}</p>
            <p class="user-info">Password: ${user.Password}</p>
            <p class="user-info">Role: ${user.Role}</p>
        </div>
        `;
        // כפתור המחיקה של משתמשים במערכת
        userElement.innerHTML += `<button class="delete-btn" style="display: block; margin: 0 auto;" data-id="${user._id}">Delete</button>`;
            userElement.querySelector('.delete-btn').addEventListener('click', async () => {
                const userId = user._id;
                try {
                    const response = await fetch(`/Users/${userId}`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        userElement.remove(); // Remove the user row from the UI
                    } else {
                        console.error('Failed to delete user');
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                }
            });
        usersContainer.appendChild(userElement);
    }


    document.getElementById('add-user-form').addEventListener('submit', async function(event) {
        event.preventDefault();
        const formData = {};
        const inputs = this.querySelectorAll('input, select');
        inputs.forEach(input => {
            formData[input.name] = input.value;
        });

        // Save username and password to "user" collection
        const userFormData = {
            UserName: formData.UserName,
            Password: formData.Password,
            Role: formData.RoleType
        };

        // Save username, email, and phone to "partner" collection
        if formData.RoleType == "Customer"{
            const CustomerFormData = {
                UserName: formData.UserName,
                Email: formData.Email,
                Phone: formData.Phone
            };
        }
        
        try {
            // Save data to "user" collection
            const userResponse = await fetch('/add-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userFormData)
            });
            
            if (!userResponse.ok) {
                console.error('Failed to add user to "user" collection');
                showMessage('Failed to add user.', 'error');
                return;
            }

            // Save data to "partner" collection
            const partnerResponse = await fetch('/add-partner', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(partnerFormData)
            });

            if (!partnerResponse.ok) {
                console.error('Failed to add user to "partner" collection');
                showMessage('Failed to add user to partner.', 'error');
                return;
            }

            // If both saves are successful, show success message
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('email').value = '';
            document.getElementById('phone').value = '';


            showMessage('User and partner added successfully!', 'success');

            // Refresh the page after 5 seconds
            setTimeout(() => {
                window.location.reload();
            }, 5000);
        } catch (error) {
            console.error('Error adding user:', error);
            showMessage('Error adding user.', 'error');
        }
    });

    function showMessage(message, type) {
        const messageContainer = document.createElement('div');
        messageContainer.classList.add('message-container');
        messageContainer.textContent = message;
        messageContainer.style.backgroundColor = type === 'success' ? '#d4edda' : '#f8d7da';
        messageContainer.style.color = type === 'success' ? '#155724' : '#721c24';
        messageContainer.style.border = '1px solid ' + (type === 'success' ? '#c3e6cb' : '#f5c6cb');
        messageContainer.style.padding = '10px';
        messageContainer.style.margin = '10px 0';
        messageContainer.style.borderRadius = '5px';
        document.body.appendChild(messageContainer);
        setTimeout(() => {
            messageContainer.remove();
        }, 5000);
    }
</script>

</body>
</html>
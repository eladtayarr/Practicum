<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Admin Dashboard</title>

    <!-- Montserrat Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/styles.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>



    <link rel="shortcut icon" href="../../../../../src/images/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="../../../../../src/images/favicon.ico" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,300" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="../../../../../src/css/animate.css" />
    <link rel="stylesheet" href="../../../../../src/css/icomoon.css" />
    <link rel="stylesheet" href="../../../../../src/css/bootstrap.css" />
    <link rel="stylesheet" href="../../../../../src/css/superfish.css" />
    <link rel="stylesheet" href="../../../../../src/css/flexslider.css" />
    <link rel="stylesheet" href="../../../../../src/css/magnific-popup.css" />
    <link rel="stylesheet" href="../../../../../src/css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../../../../../src/css/cs-select.css" />
    <link rel="stylesheet" href="../../../../../src/css/cs-skin-border.css" />
    <link rel="stylesheet" href="../../../../../src/css/style.css" />

    <script src="../../../../../src/js/modernizr-2.6.2.min.js"></script>


    <style>
      .my-table {
        width: 90%;
        margin: auto;
        border-collapse: collapse;
        font-size: 14px;            
      }
      .my-table th, 
        .my-table td {
            padding: 15px; /* ריווח פנימי */
            text-align: center; /* מיקום הטקסט במרכז */
            /*border: 1px solid rgba(89, 131, 146, 0.5);  גבולות בין תאים */
        }

        
        .my-table th {
            background-color: #2c7da0; /* צבע רקע לכותרת */
            color: white; /* צבע טקסט */
            font-weight: bold; /* טקסט מודגש */
        }
        
        .my-table tbody tr:nth-child(even) {
            background-color: rgba(168, 217, 250, 0.15); /* צבע שונה לשורות זוגיות */
        }
        
        .my-table tbody tr:hover {
            background-color: #468faf; /* צבע רקע בזמן ריחוף */
            color: white;
          }
        
          /* עיגול פינות */
        .my-table th:first-child {
            border-top-left-radius: 0px;
        }
        .my-table th:last-child {
            border-top-right-radius: 0px;
        }
        .my-table td:first-child {
            border-bottom-left-radius: 0px;
        }
        .my-table td:last-child {
            border-bottom-right-radius: 0px;
        }


    </style>
  </head>
  <body>
    <div class="grid-container">

      <!-- Header -->
      <header id="fh5co-header-section" class="sticky-banner">
        <div class="container">
          <div class="nav-header">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle dark"
              ><i></i
            ></a>
            <h1 id="fh5co-logo">
              <a href="../../../templates/Manager/ManagerHome.html"
                ><i class="icon-home"></i> תריסי סיני <span> בע״מ.</span>
              </a>
            </h1>
            <nav id="fh5co-menu-wrap" role="navigation">
              <ul class="sf-menu" id="fh5co-primary-menu">
                <li>
                  <a href="../../../templates/Manager/ManagerHome.html">דף הבית</a>
                </li>
                <li>
                  <a>מוצרים</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a
                        href="../../../templates/Products/allProducts-Manager.html"
                        >צפייה בכל המוצרים</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Products/addNewProduct-Manager.html"
                        >הוספת מוצר חדש</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Products/updateProducts-Manager.html"
                        >עדכון מוצר</a
                      >
                    </li>
                  </ul>
                </li>
                <!-- New "Deals" tab containing "Deal" and "Deals View" links -->
                <li>
                  <a>מכירות</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a href="../../../templates/Manager/DealsV-Manager.html"
                        >צפייה בכל המכירות</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Manager/addD-Manager.html"
                        >הוספת מכירה חדשה</a
                      >
                    </li>
                  </ul>
                </li>

                <li>
                  <a>ניהול</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a
                        href="../../../templates/Manager/addNewCustomer-Manager.html"
                        >הוספת לקוח חדש</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Manager/Add_ViewUsers-Manager.html"
                        >הוספת משתמש חדש</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Installer/Add-Installations.html"
                        >הוספת מתקין חדש</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a>התקנות</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a
                        href="../../../templates/Installer/View-Installations.html"
                        >צפייה בכל ההתקנות</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Installer/add-Installer.html"
                        >הוספת התקנה חדשה</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a>דוחות</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a href="../../../templates/Reports/Reports-Customer.html"
                        >דוח לקוחות</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Reports/Reports-Deal.html"
                        >דוח מכירות</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Reports/Reports-Products.html"
                        >דוח מוצרים</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="../../../templates/Dashbords/Manager/Dashbord-Manager.html">
                    לוח בקרה
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <!-- End Header -->

      <!-- Sidebar -->
      <aside id="sidebar">
        <div class="sidebar-title">
          <div class="sidebar-brand">
            לוח בקרה
          </div>
          <span class="material-icons-outlined" onclick="closeSidebar()">סגירה</span>
        </div>

        <ul class="sidebar-list">
          <li class="sidebar-list-item">
            <a href="Public/templates/Dashbords/Manager/Dashbord-Manager.html" target="_blank"><span class="material-icons-outlined">dashboard</span> ראשי
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="products_dashboard.html" target="_blank"><span class="material-icons-outlined">inventory_2</span> מוצרים
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="installers_dashboard.html" target="_blank">
                <span class="material-symbols-outlined">interactive_space</span> מתקינים
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="#" target="_blank">
                <span class="material-symbols-outlined">contacts_product</span> לקוחות
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="revach_efsed_dashboard.html" target="_blank">
              <span class="material-icons-outlined">currency_exchange</span> רווח והפסד
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="reports_dashboard.html" target="_blank">
              <span class="material-symbols-outlined">lab_profile</span> דוחות
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="archive_dashboard.html" target="_blank">
              <span class="material-icons-outlined">archive</span> ארכיון
            </a>
          </li>

        </ul>
      </aside>
      <!-- End Sidebar -->

      <!-- Main -->
      <main class="main-container">
        <div class="main-title">
          <p class="font-weight-bold">לוח בקרה ראשי</p>
        </div>

        <div class="main-cards">
          <!-- סה״כ מוצרים -->
          <div class="card">
            <div class="card-inner">
              <p class="text-primary">מוצרים <br>(סה״כ)</p>
              <span class="material-icons-outlined text-blue">inventory_2</span>
            </div>
            <span id="totalProducts" class="text-primary font-weight-bold">Loading...</span>
          </div>
          <!-- סה״כ מכירות -->
          <div class="card">
            <div class="card-inner">
              <p class="text-primary">סה״כ מכירות <br>(שנתי)</p>
              <span class="material-icons-outlined text-orange">add_shopping_cart</span>
            </div>
            <span class="text-primary font-weight-bold">83</span>
          </div>
          <!-- הכנסות ממכירות -->
          <div class="card">
            <div class="card-inner">
              <p class="text-primary">הכנסות ממכירות <br> (ב-ש״ח)</p>
              <span class="material-icons-outlined text-green">shopping_cart</span>
            </div>
            <span class="text-primary font-weight-bold">250,000</span>
          </div>
          <!-- הזמנות פתוחות -->
          <div class="card">
            <div class="card-inner">
              <p class="text-primary">הזמנות פתוחות <br> (בתהליך)</p>
              <span class="material-icons-outlined text-red">notification_important</span>
            </div>
            <span id="totalMeetings" class="text-primary font-weight-bold">Loading...</span>
          </div>

        </div>

        <!-- כמות מוצרים לפי סוג -->
        <div class="charts">
            <div class="charts-card">
                <p class="chart-title">כמות מוצרים לפי סוג</p>
                <div id="bar-chart"></div>
        </div>
        
        <!-- הזמנות רכש ומכירה -->
        <div class="charts-card">
            <p class="chart-title">הזמנות רכש ומכירה</p>
            <div id="area-chart"></div>
        </div>

        <!-- הזמנות רכש ומכירה -->
        <div class="charts-card">
            <p class="chart-title">הזמנות רכש ומכירה</p>
            <div id="pie-chart"></div>
        </div>

        <!-- לקוחות מול יעד -->
        <div class="dubble-charts">
          <div class="charts-card-half">
            <p class="chart-title">לקוחות מול יעד</p>
            <div id="speedometer-chart"></div>
            <p>סה״כ לקוחות</p>
            <p class="chart-title-inside"> היעד הוא 50 לקוחות</p>
          </div>
        </div>
        
        <!-- רשימת משימות לביצוע -->
        <div class="charts-card">
          <div class="todo-container">
            <p class="chart-title">רשימת משימות לביצוע</p>
            <form id="todoForm" class="todo-form">
              <input type="text" id="todoInput" placeholder="הוספת משימה חדשה..." required />
              <button type="submit" class="add-btn">הוספה</button>
            </form>
            <ul id="todoList" class="todo-list"></ul>
            <p id="todoError" style="color: #e5383b; display: none;">Error loading TODO items.</p>
          </div>
        </div>
        
        <!-- רשימת אנשי קשר - מתקינים -->
        <div class="charts-card">
            <p class="chart-title">רשימת אנשי קשר - מתקינים</p>
            <table id="installersTable" class="my-table" style="width=100%">
              <thead>
                <tr>
                  <th>קוד מתקין</th>
                  <th>שם מלא</th>
                  <th>מספר טלפון</th>
                  <th>אימייל</th>
                  <th>אזור פעילות</th>
                </tr>
              </thead>
              <tbody>
                <!-- הנתונים יתעדכנו כאן -->
              </tbody>
            </table>
            <script>
              document.addEventListener("DOMContentLoaded", async function () {
                try {
                  const response = await fetch("/viewInstaller"); // קריאה לנתיב בשרת
                  if (!response.ok) {
                    throw new Error("Failed to fetch installers data");
                  }
        
                  const installers = await response.json();
                  const tableBody = document.querySelector("#installersTable tbody");
        
                  installers.forEach((installer) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                      <td>${installer.InstallerID}</td>
                      <td>${installer.FullName}</td>
                      <td>${installer.Phone}</td>
                      <td>${installer.Email}</td>
                      <td>${installer.AreaType}</td>
                    `;
                    tableBody.appendChild(row);
                  });
                } catch (error) {
                  console.error("Error loading installers data:", error);
                }
              });
            </script>
        </div>        
      </main>
      <!-- End Main -->

    </div>

    <!-- Scripts -->
    <!-- ApexCharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.35.3/apexcharts.min.js"></script>
    <!-- Custom JS -->
    <script src="js/scripts.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          // Fetch product data
          const productResponse = await fetch("/dashboard-data/products");
          if (!productResponse.ok) {
            throw new Error("Failed to fetch product data");
          }
          const productData = await productResponse.json();
          document.getElementById("totalProducts").textContent =
            productData.productsCount || "No data";

            
          // Fetch product data
          const meetingsResponse = await fetch("/dashboard-data/Meetings");
          if (!meetingsResponse.ok) {
            throw new Error("Failed to fetch meeting data");
          }
          const meetingsData = await meetingsResponse.json();
          document.getElementById("totalMeetings").textContent =
          meetingsData.meetingCount || "No data";
          } 
        
        catch (error) {
          console.error("Error loading data:", error);
          document.getElementById("totalMeetings").textContent = "Error loading meetings";
          document.getElementById("totalProducts").textContent = "Error loading products";
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          // Fetch customers data
          const response = await fetch("/dashboard-data/customers");
          if (!response.ok) {
            throw new Error("Failed to fetch customers data");
          }
    
          const data = await response.json();
          const customersCount = data.customersCount || 0;
    
          // הגדרת היעד המקסימלי
          const target = 50;          
    
          // Render Speedometer
          const options = {
            chart: {
              type: "radialBar",
              offsetY: -20,
            },
            plotOptions: {
              radialBar: {
                startAngle: -90,
                endAngle: 90,
                track: {
                  background: "#e7e7e7",
                  strokeWidth: "97%",
                  margin: 5,
                },
                dataLabels: {
                  name: {
                    show: true,
                    fontSize: "16px",
                  },
                  value: {
                    fontSize: "14px",
                    show: true,
                  },
                },
              },
            },
            series: [(customersCount / target) * 100], // אחוז מהיעד
            labels: ["לקוחות"],
          };
    
          const chart = new ApexCharts(
            document.querySelector("#speedometer-chart"),
            options
          );
          chart.render();
        } catch (error) {
          console.error("Error loading speedometer data:", error);
          const speedometerContainer = document.querySelector("#speedometer-chart");
          speedometerContainer.textContent = "Error loading speedometer data";
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const todoForm = document.getElementById("todoForm");
        const todoInput = document.getElementById("todoInput");
        const todoList = document.getElementById("todoList");
        const todoError = document.getElementById("todoError");
      
        // Fetch and display TODO items
        const fetchTodos = async () => {
          try {
            const response = await fetch("/api/todos");
            if (!response.ok) {
              throw new Error("Failed to fetch TODO items");
            }
      
            const todos = await response.json();
            todoList.innerHTML = ""; // Clear the list
            todos.forEach((todo) => addTodoToDOM(todo));
          } catch (error) {
            console.error("Error fetching TODO items:", error);
            todoError.style.display = "block";
          }
        };
      
        // Add TODO to the DOM
        const addTodoToDOM = (todo) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <span>${todo.text}</span>
            <button onclick="deleteTodo('${todo._id}')">Delete</button>
          `;
          todoList.appendChild(li);
        };
      
        // Add TODO to the database
        todoForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const text = todoInput.value.trim();
          if (!text) return;
      
          try {
            const response = await fetch("/api/todos", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ text }),
            });
            const newTodo = await response.json();
            addTodoToDOM({ _id: newTodo.id, text });
            todoInput.value = "";
          } catch (error) {
            console.error("Error adding TODO item:", error);
          }
        });
      
        // Delete TODO from the database
        window.deleteTodo = async (id) => {
          try {
            const response = await fetch(`/api/todos/${id}`, { method: "DELETE" });
            if (response.ok) fetchTodos();
          } catch (error) {
            console.error("Error deleting TODO item:", error);
          }
        };
      
        // Initial fetch
        fetchTodos();
      });      
    </script>
    
    
    
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Admin Dashboard</title>

    <!-- Montserrat Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>



    <link rel="shortcut icon" href="../../../../src/images/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="../../../../src/images/favicon.ico" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,300" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="../../../../src/css/animate.css" />
    <link rel="stylesheet" href="../../../../src/css/icomoon.css" />
    <link rel="stylesheet" href="../../../../src/css/bootstrap.css" />
    <link rel="stylesheet" href="../../../../src/css/superfish.css" />
    <link rel="stylesheet" href="../../../../src/css/flexslider.css" />
    <link rel="stylesheet" href="../../../../src/css/magnific-popup.css" />
    <link rel="stylesheet" href="../../../../src/css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../../../../src/css/cs-select.css" />
    <link rel="stylesheet" href="../../../../src/css/cs-skin-border.css" />
    <link rel="stylesheet" href="../../../../src/css/style.css" />

    <script src="../../../../src/js/modernizr-2.6.2.min.js"></script>


    <style>
      .my-table {
        width: 50%;
        margin: auto;
        border-collapse: collapse;
        font-size: 14px;            
      }
      .my-table th, 
        .my-table td {
            padding: 15px; /* ריווח פנימי */
            text-align: center; /* מיקום הטקסט במרכז */
            /*border: 1px solid rgba(89, 131, 146, 0.5);  גבולות בין תאים */
        }

        
        .my-table th {
            background-color: #2c7da0; /* צבע רקע לכותרת */
            color: white; /* צבע טקסט */
            font-weight: bold; /* טקסט מודגש */
        }
        
        .my-table tbody tr:nth-child(even) {
            background-color: rgba(168, 217, 250, 0.15); /* צבע שונה לשורות זוגיות */
        }
        
        .my-table tbody tr:hover {
            background-color: #468faf; /* צבע רקע בזמן ריחוף */
            color: white;
        }

                /* עיגול פינות */
        .my-table th:first-child {
            border-top-left-radius: 10px;
        }
        .my-table th:last-child {
            border-top-right-radius: 10px;
        }
        .my-table td:first-child {
            border-bottom-left-radius: 10px;
        }
        .my-table td:last-child {
            border-bottom-right-radius: 10px;
        }


    </style>
  </head>
  <body>
    <div class="grid-container">

      <!-- Header -->
      <header id="fh5co-header-section" class="sticky-banner">
        <div class="container">
          <div class="nav-header">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle dark"
              ><i></i
            ></a>
            <h1 id="fh5co-logo">
              <a href="../../../templates/Manager/HomeManager.html"
                ><i class="icon-home"></i> Trisi Sinai <span> Ltd.</span>
              </a>
            </h1>
            <nav id="fh5co-menu-wrap" role="navigation">
              <ul class="sf-menu" id="fh5co-primary-menu">
                <li class="active">
                  <a href="../../../templates/Manager/HomeManager.html">Home</a>
                </li>
                <li>
                  <a>Products</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a
                        href="../../../templates/Products/allProducts-Manager.html"
                        >View All Products</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Products/addNewProduct-Manager.html"
                        >Add New Product</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Products/updateProducts-Manager.html"
                        >Update Product</a
                      >
                    </li>
                  </ul>
                </li>
                <!-- New "Deals" tab containing "Deal" and "Deals View" links -->
                <li>
                  <a>Deals</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a href="../../../templates/Manager/DealsV-Manager.html"
                        >View All Deals</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Manager/addD-Manager.html"
                        >Add New Deal</a
                      >
                    </li>
                  </ul>
                </li>

                <li>
                  <a>Manage</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a
                        href="../../../templates/Manager/addNewCustomer-Manager.html"
                        >Add New Customer</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Manager/Add_ViewUsers-Manager.html"
                        >Add New Users</a
                      >
                    </li>
                    <li>
                      <a
                        href="../../../templates/Installer/Add-Installations.html"
                        >Add New Installer</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a>Installations</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a
                        href="../../../templates/Installer/View-Installations.html"
                        >View All Installations</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Installer/add-Installer.html"
                        >Add New Installation</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a>Reports</a>
                  <ul class="fh5co-sub-menu">
                    <li>
                      <a href="../../../templates/Reports/Reports-Customer.html"
                        >Customers Reports</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Reports/Reports-Deal.html"
                        >Deals Reports</a
                      >
                    </li>
                    <li>
                      <a href="../../../templates/Reports/Reports-Products.html"
                        >Products Reports</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="../../../templates/Dashbords/Manager/Dashbord-Manager.html">
                    Manager Dashbord
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <!-- End Header -->

      <!-- Sidebar -->
      <aside id="sidebar">
        <div class="sidebar-title">
          <div class="sidebar-brand">
            Avi's Dashboard
          </div>
          <span class="material-icons-outlined" onclick="closeSidebar()">close</span>
        </div>

        <ul class="sidebar-list">
          <li class="sidebar-list-item">
            <a href="#" target="_blank"><span class="material-icons-outlined">dashboard</span> Dashboard
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="#" target="_blank"><span class="material-icons-outlined">inventory_2</span> Products
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="#" target="_blank">
                <span class="material-symbols-outlined">interactive_space</span> Installations
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="#" target="_blank">
                <span class="material-symbols-outlined">contacts_product</span> Customers
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="#" target="_blank">
              <span class="material-icons-outlined">currency_exchange</span> Profit and loss
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="#" target="_blank">
              <span class="material-symbols-outlined">lab_profile</span> Reports
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="#" target="_blank">
              <span class="material-icons-outlined">archive</span> Archive
            </a>
          </li>

        </ul>
      </aside>
      <!-- End Sidebar -->

      <!-- Main -->
      <main class="main-container">
        <div class="main-title">
          <p class="font-weight-bold">DASHBOARD</p>
        </div>

        <div class="main-cards">

          <div class="card">
            <div class="card-inner">
              <p class="text-primary">PRODUCTS <br>(total)</p>
              <span class="material-icons-outlined text-blue">inventory_2</span>
            </div>
            <span id="totalProducts" class="text-primary font-weight-bold">Loading...</span>
          </div>

          <div class="card">
            <div class="card-inner">
              <p class="text-primary">TOTAL SALES <br>(annual)</p>
              <span class="material-icons-outlined text-orange">add_shopping_cart</span>
            </div>
            <span class="text-primary font-weight-bold">83</span>
          </div>

          <div class="card">
            <div class="card-inner">
              <p class="text-primary">SALES REVENUE <br> (NIS)</p>
              <span class="material-icons-outlined text-green">shopping_cart</span>
            </div>
            <span class="text-primary font-weight-bold">250,000</span>
          </div>

          <div class="card">
            <div class="card-inner">
              <p class="text-primary">OPEN ORDERS <br> (in progress)</p>
              <span class="material-icons-outlined text-red">notification_important</span>
            </div>
            <span id="totalMeetings" class="text-primary font-weight-bold">Loading...</span>
          </div>

        </div>

        <div class="charts">
            <div class="charts-card">
                <p class="chart-title">Quantity Of Products by Type</p>
                <div id="bar-chart"></div>
        </div>
        
        <div class="charts-card">
            <p class="chart-title">Purchase and Sales Orders</p>
            <div id="area-chart"></div>
        </div>

        <div class="charts-card">
            <p class="chart-title">Purchase and Sales Orders</p>
            <div id="pie-chart"></div>
        </div>

        <div class="dubble-charts">
          <div class="charts-card-half">
            <p class="chart-title">Customers vs Target</p>
            <div id="speedometer-chart"></div>
            <p>Total customers</p>
            <p class="chart-title-inside"> The Target is 50 customers</p>
          </div>
        </div>
        
        <div class="charts-card">
          <div class="todo-container">
            <p class="chart-title">My TODO List</p>
            <form id="todoForm" class="todo-form">
              <input type="text" id="todoInput" placeholder="Add a new task..." required />
              <button type="submit" class="add-btn">Add</button>
            </form>
            <ul id="todoList" class="todo-list"></ul>
            <p id="todoError" style="color: red; display: none;">Error loading TODO items.</p>
          </div>
        </div>
        
        
        <div class="charts-card">
            <p class="chart-title">Installers Contact List</p>
            <table id="installersTable" class="my-table" style="width=100%">
              <thead>
                <tr>
                  <th>Installer ID</th>
                  <th>Full Name</th>
                  <th>Phone Number</th>
                  <th>Email</th>
                  <th>Working Area</th>
                </tr>
              </thead>
              <tbody>
                <!-- הנתונים יתעדכנו כאן -->
              </tbody>
            </table>
            <script>
              document.addEventListener("DOMContentLoaded", async function () {
                try {
                  const response = await fetch("/installers"); // קריאה לנתיב בשרת
                  if (!response.ok) {
                    throw new Error("Failed to fetch installers data");
                  }
        
                  const installers = await response.json();
                  const tableBody = document.querySelector("#installersTable tbody");
        
                  installers.forEach((installer) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                      <td>${installer.InstallerID}</td>
                      <td>${installer.FullName}</td>
                      <td>${installer.Phone}</td>
                      <td>${installer.Email}</td>
                      <td>${installer.AreaType}</td>
                    `;
                    tableBody.appendChild(row);
                  });
                } catch (error) {
                  console.error("Error loading installers data:", error);
                }
              });
            </script>
        </div>        
      </main>
      <!-- End Main -->

    </div>

    <!-- Scripts -->
    <!-- ApexCharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.35.3/apexcharts.min.js"></script>
    <!-- Custom JS -->
    <script src="js/scripts.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          // Fetch product data
          const productResponse = await fetch("/dashboard-data/products");
          if (!productResponse.ok) {
            throw new Error("Failed to fetch product data");
          }
          const productData = await productResponse.json();
          document.getElementById("totalProducts").textContent =
            productData.productsCount || "No data";

            
          // Fetch product data
          const meetingsResponse = await fetch("/dashboard-data/Meetings");
          if (!meetingsResponse.ok) {
            throw new Error("Failed to fetch meeting data");
          }
          const meetingsData = await meetingsResponse.json();
          document.getElementById("totalMeetings").textContent =
          meetingsData.meetingCount || "No data";
          } 
        
        catch (error) {
          console.error("Error loading data:", error);
          document.getElementById("totalMeetings").textContent = "Error loading meetings";
          document.getElementById("totalProducts").textContent = "Error loading products";
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          // Fetch customers data
          const response = await fetch("/dashboard-data/customers");
          if (!response.ok) {
            throw new Error("Failed to fetch customers data");
          }
    
          const data = await response.json();
          const customersCount = data.customersCount || 0;
    
          // הגדרת היעד המקסימלי
          const target = 50;          
    
          // Render Speedometer
          const options = {
            chart: {
              type: "radialBar",
              offsetY: -20,
            },
            plotOptions: {
              radialBar: {
                startAngle: -90,
                endAngle: 90,
                track: {
                  background: "#e7e7e7",
                  strokeWidth: "97%",
                  margin: 5,
                },
                dataLabels: {
                  name: {
                    show: true,
                    fontSize: "16px",
                  },
                  value: {
                    fontSize: "14px",
                    show: true,
                  },
                },
              },
            },
            series: [(customersCount / target) * 100], // אחוז מהיעד
            labels: ["Customers"],
          };
    
          const chart = new ApexCharts(
            document.querySelector("#speedometer-chart"),
            options
          );
          chart.render();
        } catch (error) {
          console.error("Error loading speedometer data:", error);
          const speedometerContainer = document.querySelector("#speedometer-chart");
          speedometerContainer.textContent = "Error loading speedometer data";
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const todoForm = document.getElementById("todoForm");
        const todoInput = document.getElementById("todoInput");
        const todoList = document.getElementById("todoList");
        const todoError = document.getElementById("todoError");
      
        // Fetch and display TODO items
        const fetchTodos = async () => {
          try {
            const response = await fetch("/api/todos");
            if (!response.ok) {
              throw new Error("Failed to fetch TODO items");
            }
      
            const todos = await response.json();
            todoList.innerHTML = ""; // Clear the list
            todos.forEach((todo) => addTodoToDOM(todo));
          } catch (error) {
            console.error("Error fetching TODO items:", error);
            todoError.style.display = "block";
          }
        };
      
        // Add TODO to the DOM
        const addTodoToDOM = (todo) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <span>${todo.text}</span>
            <button onclick="deleteTodo('${todo._id}')">Delete</button>
          `;
          todoList.appendChild(li);
        };
      
        // Add TODO to the database
        todoForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const text = todoInput.value.trim();
          if (!text) return;
      
          try {
            const response = await fetch("/api/todos", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ text }),
            });
            const newTodo = await response.json();
            addTodoToDOM({ _id: newTodo.id, text });
            todoInput.value = "";
          } catch (error) {
            console.error("Error adding TODO item:", error);
          }
        });
      
        // Delete TODO from the database
        window.deleteTodo = async (id) => {
          try {
            const response = await fetch(`/api/todos/${id}`, { method: "DELETE" });
            if (response.ok) fetchTodos();
          } catch (error) {
            console.error("Error deleting TODO item:", error);
          }
        };
      
        // Initial fetch
        fetchTodos();
      });      
    </script>
    
    
    
  </body>
</html>
<!DOCTYPE html>
<html class="no-js" dir="rtl" lang="he">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>תריסי סיני || פרקטיקום</title>
    <link rel="shortcut icon" href="../../src/images/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="shortcut icon" href="../../src/images/favicon.ico" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,300"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="../../src/css/animate.css" />
    <link rel="stylesheet" href="../../src/css/icomoon.css" />
    <link rel="stylesheet" href="../../src/css/bootstrap.css" />
    <link rel="stylesheet" href="../../src/css/superfish.css" />
    <link rel="stylesheet" href="../../src/css/flexslider.css" />
    <link rel="stylesheet" href="../../src/css/magnific-popup.css" />
    <link rel="stylesheet" href="../../src/css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../../src/css/cs-select.css" />
    <link rel="stylesheet" href="../../src/css/cs-skin-border.css" />
    <link rel="stylesheet" href="../../src/css/style.css" />
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <!--  חלונית popup הסברים  -->
    <script src="../../src/js/popup-explain.js"></script>
    <link rel="stylesheet" href="../../src/css/popup-style.css" />

    <style>
      body {
        font-family: "Open Sans", sans-serif;
        color: #333;
        background-color: #f8f8f8;
      }
      .form-group {
        max-width: 500px;
        margin: 0 auto;
        padding: 20px;
      }
      #sub {
        display: block;
        margin: 0 auto;
        padding: 15px;
        width: fit-content;
      }
      .property-button {
        margin: 0 10px;
        padding: 10px 20px;
        background-color: #d1869b;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .property-button:hover {
        background-color: rgb(38, 152, 191);
      }
      #footer #fh5co-header-subscribe button {
        position: absolute;
        top: 20px;
        right: -20px;
        border-top-left-radius: 0px !important;
        border-bottom-left-radius: 0px !important;
        background: #1a759f;
        border: none;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: center;
      }
      th {
        background-color: #f4f4f4;
        font-weight: bold;
      }
      td {
        background-color: #fff;
      }
      .Products-table button {
        background-color: #d1869b;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 4px;
        transition: background-color 0.3s ease;
      }
      .Products-table button:hover {
        background-color: rgb(38, 152, 191);
      }
    </style>
  </head>
  <body>
    <div id="fh5co-wrapper">
      <div id="fh5co-page">
        <header id="fh5co-header-section" class="sticky-banner">
          <div class="container">
            <div class="nav-header">
              <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle dark"><i></i></a>
              <h1 id="fh5co-logo">
                <a href="../../templates/Manager/ManagerHome.html">
                  <i class="icon-home"></i> תריסי סיני <span> בע״מ.</span>
                </a>
            <nav id="fh5co-menu-wrap" role="navigation">
                <ul class="sf-menu" id="fh5co-primary-menu">
                  <li>
                    <a href="../../templates/Manager/ManagerHome.html">דף הבית</a>
                  </li>

                  <li>
                    <a>מוצרים ומלאי</a>
                    <ul class="fh5co-sub-menu">
                      <li><a href="../../templates/Manager/View-ordersRequests.html">צפייה בבקשות להזמנה</a></li>
                      <li><a href="../../templates/Products/allProducts-Manager.html">צפייה בכל המוצרים</a></li>
                      <li><a href="../../templates/Products/addNewProduct-Manager.html">הוספת מוצר חדש</a></li>
                      <li><a href="../../templates/Products/updateProducts-Manager.html">עדכון/מחיקת מוצר קיים</a></li>
                    </ul>
                  </li>

                  <li>
                    <a>הפקת טפסים</a>
                    <ul class="fh5co-sub-menu">
                      <li><a href="../../templates/Forms/ManagerForms.html">צפייה</a></li>
                      <li><a href="../../templates/Reports/Reports-Deal.html">הוספה</a></li>
                    </ul>
                  </li>

                  <li>
                    <a>דוחות</a>
                    <ul class="fh5co-sub-menu">
                      <li><a href="../../templates/Reports/Reports-Customer.html">דוח לקוחות</a></li>
                      <li><a href="../../templates/Reports/Reports-Installer.html">דוח מתקינים</a></li>
                      <li><a href="../../templates/Reports/Reports-Products.html">דוח מוצרים</a></li>
                      <li><a href="../../templates/Reports/Reports-CustomersFeedback.html">דוח משוב לקוחות</a></li>
                    </ul>
                  </li>

                  <li>
                    <a>משתמשים/הרשאות</a>
                    <ul class="fh5co-sub-menu">
                      <li><a href="../../templates/Manager/addNewCustomer-Manager.html">הוספת לקוח חדש</a></li>
                      
                      <li><a href="../../templates/Installer/Add-Installer.html">הוספת מתקין חדש</a></li>
                    </ul>
                  </li>

                  <li>
                    <a>מכרזים</a>
                    <ul class="fh5co-sub-menu">
                      <li><a href="../../templates/Tenders/allTenders.html">צפייה במכרזים</a></li>
                      <li><a href="../../templates/Tenders/addTenders.html">הוספת מכרז חדש</a></li>
                      <li><a href="../../templates/Tenders/updateTenders.html">מחיקה/עריכת מכרז</a></li>
                    </ul>
                  </li>

                  <li>
                    <a>התקנות</a>
                    <ul class="fh5co-sub-menu">
                      <li><a href="../../templates/Installer/View-Installations.html">צפייה בכל ההתקנות</a></li>
                      <li><a href="../../templates/Installer/Add-Installations.html">הוספת התקנה חדשה</a></li>
                      <li><a href="../../templates/Installer/Manage-Installations.html">ניהול התקנות</a></li>
                    </ul>
                  </li>

                  <li>
                  <li><a href="../../templates/Dashbords/Manager/Dashbord-Manager.html">לוח בקרה</a></li>
                  <!-- (?) כפתור העזרה -->
                  <li>
                    <a><svg id="infoIcon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg></a>
                  </li>
                  <!-- חלונית ה-popup -->
                  <div id="popup" class="popup">
                    <div class="popup-content">
                      <span id="closePopup" class="close">&times;</span>
                      <h3 class="popup-title">עדכון/מחיקת מוצר קיים</h3>
                      <br>
                      <div class="popup-sec-title">
                        <h7>הסבר על השדות והפעולות בדף</h7>
                        <div class="popup-sec-text">
                          <p>◆ <u>בחירת מוצר</u> - בחר מוצר מתוך הרשימה לעריכה או מחיקה.</p>
                          <p>◆ <u>עריכת שדות</u> - ניתן לערוך את סוג המוצר, תיאור, מחיר, סטטוס וקישור לתמונה.</p>
                          <p>◆ <u>שמירה</u> - לאחר עריכה, לחץ על "שמור שינויים" לעדכון המוצר.</p>
                          <p>◆ <u>מחיקה</u> - לחץ על "מחק" כדי להסיר את המוצר מהמלאי.</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </ul>
            </nav>
            </div>
          </div>
        </header>

    <aside id="fh5co-hero" class="js-fullheight">
        <div class="flexslider js-fullheight">
            <ul class="slides">
                <li style="background-image: url(https://images.unsplash.com/photo-1647427017067-8f33ccbae493?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D);">
                    <div class="overlay"></div>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-8 col-md-offset-2 text-center js-fullheight slider-text">
                                <div class="slider-text-inner">
                                    <h2 class="heading-title">עדכון מוצרים</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
                       
        </div>
    </aside>

        <div id="fh5co-blog-section" class="fh5co-section-gray">
          <div class="container">
            <div class="row">
              <div class="col-md-8 col-md-offset-2 text-center heading-section animate-box">
                <h3>עדכון בפרטי המוצרים</h3>
              </div>
            </div>
          </div>
            <table
              id="productsTable"
              class="Products-table"
              border="1"
              style="width: 100%; text-align: center">
              <thead>
                <tr>
                  <th>קוד מוצר</th>
                  <th>סוג מוצר</th>
                  <th>מחיר</th>
                  <th>תאריך ייצור</th>
                  <th>תיאור</th>
                  <th>סטטוס</th>
                  <th>עדכון המוצר</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div id="errorMessage" style="display: none;" class="alert alert-warning" role="alert">אזהרה - חלק מהפרטים שהוזנו ריקים !</div>
            <div id="updateFormProducts" style="display: none">
              <form>
                <label for="updateProductID">קוד מוצר:</label>
                <input id="updateProductID" type="text" readonly />
                <br />
                
                <label for="updateProductType">סוג מוצר:</label>
                
                <select id="updateProductType" type="text" value="וילונות">
                  <option value="וילונות">וילונות</option>
                  <option value="תריסים">תריסים</option>
                  <option value="מסגרות">מסגרות</option>
                  <option value="אביזרים">אביזרים</option>
                  <option value="אחר">אחר</option>
                </select>
                <br /><br />
                
                <label for="updateProductPrice">מחיר המוצר:</label>
                <input id="updateProductPrice" type="integer" />
                <br /><br />
                
                <label for="updateProductionDate">תאריך ייצור:</label>
                <input id="updateProductionDate" type="date" />
                <br /><br />
                
                <label for="updateProductDescription">תיאור המוצר:</label>
                <input id="updateProductDescription" type="text" />
                <br /><br />
                
                <label for="updateProductStatus">סטטוס:</label>
                <select id="updateProductStatus" type="text">
                  <option value="זמין">זמין</option>
                  <option value="לא זמין">לא זמין</option>
                </select>
                <br /><br />
                
                <button type="button" class="btn btn-primary" onclick="updateProducts()">שמור שינויים</button>
                <button type="button" class="btn btn-primary" onclick="closeUpdateForm()">סגור</button>
              </form>
            </div>

            <div class="calendar" id="meetingList"></div>
          </div>
        </div>

        <footer>
          <div id="footer">
            <div class="container">
              <div class="row row-bottom-padded-md">
                <!-- זכויות יוצרים -->
                <p style="font-size:20px;">
                  &copy; <span id="year"></span>כל הזכויות שמורות לתריסי סיני בע״מ.<br/>
                  <p style="font-size:18px;">האתר נבנה ומנוהל על ידי:<br> אלעד טייר | ליאור סיני | אור מנחם | תאיר מלכה</p>
                  <a style="color: #0077b6; text-decoration: none; font-weight:500 ">Terms of Use</a>|<a style="color: #0077b6; text-decoration: none; font-weight:500">Privacy Policy</a>
                </p>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("/Products")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            console.log("Fetched Products:", data); // Debugging line to inspect fetched data
            const productsTable = document.getElementById("productsTable");
            const tbody = productsTable.querySelector("tbody");
            tbody.innerHTML = ""; // Clear the table body before adding new rows

            if (data.length === 0) {
              const noDataRow = tbody.insertRow();
              noDataRow.innerHTML = `<td colspan="6">No Products available.</td>`;
              return;
            }

            // Insert rows into the table
            data.forEach((Products) => {
              const row = tbody.insertRow();
              row.innerHTML = `
                        <td>${Products.ProductID || "N/A"}</td>
                        <td>${Products.ProductType || "N/A"}</td>
                        <td>${Products.ProductPrice || "N/A"}</td>
                        <td>${Products.ProductionDate || "N/A"}</td>
                        <td>${Products.ProductDescription || "N/A"}</td>
                        <td>${Products.ProductStatus || "N/A"}</td>
                        <td>
                            <button class="btn btn-primary"" 
                                onclick="updateFormProducts('${
                                  Products.ProductID
                                }', '${Products.ProductType}', 
                                '${Products.ProductPrice}', '${
                Products.ProductionDate
              }', 
                                '${Products.ProductDescription}', '${
                Products.ProductStatus
              }')">
                                עדכן מוצר זה
                            </button>
                        </td>
                    `;
            });
          })
          .catch((error) => {
            console.error("Error fetching Products:", error);
            document.getElementById("errorMessage").textContent ="Error loading Products. Please try again later.";});
      });

      function updateFormProducts(
        id,
        ProductType,
        ProductPrice,
        ProductionDate,
        ProductDescription,
        ProductStatus
      ) {
        currentProductId = id; // Store the current product ID

        // Fill the form with the current values
        document.getElementById("updateProductID").value = id;
        document.getElementById("updateProductType").value = ProductType;
        document.getElementById("updateProductPrice").value = ProductPrice;
        document.getElementById("updateProductionDate").value = ProductionDate;
        document.getElementById("updateProductDescription").value =
          ProductDescription;
        document.getElementById("updateProductStatus").value = ProductStatus;

        // Show the form
        document.getElementById("updateFormProducts").style.display = "block";
      }

      function updateProducts() {
        // Get updated values from the form
        const updatedData = {
          ProductID: parseInt(document.getElementById("updateProductID").value), // Parse as integer
          ProductType: document.getElementById("updateProductType").value,
          ProductPrice: parseInt(
            document.getElementById("updateProductPrice").value
          ), // Ensure it's an integer
          ProductionDate: document.getElementById("updateProductionDate").value,
          ProductDescription: document.getElementById(
            "updateProductDescription"
          ).value,
          ProductStatus: document.getElementById("updateProductStatus").value,
        };

        // Validate input before sending to the server
        if (
          !updatedData.ProductID ||
          !updatedData.ProductType ||
          !updatedData.ProductPrice
        ) {
          alert("Please fill in all required fields!");
          return;
        }

        // Send PUT request to update the product
        console.log("Updating product with ID:", currentProductId);
        console.log("Payload being sent:", updatedData);

        fetch(`/Products/${currentProductId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(updatedData),
        })
          .then((response) => {
            console.log("Response status:", response.status);
            if (!response.ok) {
              return response.text().then((text) => {
                throw new Error(text || "שגיאה בעדכון המוצר");
              });
            }
            console.log("Product updated successfully!");
            alert("המוצר עודכן בהצלחה!");
            location.reload(); // Reload the page to fetch updated data
          })
          .catch((error) => {
            document.getElementById("errorMessage").style.display = "block";
            console.error("Error updating product:", error.message);
            alert("שגיאה בעדכון המוצר. אנא נסה שוב מאוחר יותר.");
          });
      }

      function closeUpdateForm() {
        // Hide the form
        document.getElementById("updateFormProducts").style.display = "none";
      }
    </script>
<script src="../../src/js/jquery.min.js"></script>
<script src="../../src/js/jquery.easing.1.3.js"></script>
<script src="../../src/js/bootstrap.min.js"></script>
<script src="../../src/js/jquery.waypoints.min.js"></script>
<script src="../../src/js/sticky.js"></script>
<script src="../../src/js/hoverIntent.js"></script>
<script src="../../src/js/superfish.js"></script>
<script src="../../src/js/jquery.flexslider-min.js"></script>
<script src="../../src/js/bootstrap-datepicker.min.js"></script>
<script src="../../src/js/classie.js"></script>
<script src="../../src/js/selectFx.js"></script>
<script src="../../src/js/main.js"></script>
  </body>
</html>
